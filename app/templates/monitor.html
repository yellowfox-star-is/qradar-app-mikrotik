<!DOCTYPE html>
<html>
  <head>
    <title>MikroTik Monitor</title>
    <link href="static/styles.css" rel="stylesheet">
  </head>

  <body>
  
  <h2>Accordion</h2>
  
  <button class="accordion">Section 1</button>
  <div class="panel">
    Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
  </div>
  
  <button class="accordion">Section 2</button>
  <div class="panel">
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
  </div>
  
  <button class="accordion">Section 3</button>
  <div class="panel">
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
  </div>

  <button class="accordion">Legit Router</button>
  <div class="panel">
    <button class="accordion">Legit Device</button>
    <div class="panel">
      IP address: 192.168.XXX.XXX
      <br>
      MAC address: XX-XX-XX-XX-XX-XX
    </div>
  </div>
  
 <button id="zulli-butt">Zulli! Do the thing!</button>
  <div id="zulli-div"></div>

  <div id="__root">
  </div>
  
  </body>

  <script>
    document.getElementById("zulli-butt").onclick = function() {zulli()};

    function zulli()
    {
      fetch('/test_func')
        .then((response) => response.json())
        .then((data) => {
          document.getElementById("zulli-div").innerHTML += data.greeting;});
    }

    function create_top_element(id, name)
    {
        let top_element = document.createElement("button")
        top_element.className = "accordion"
        top_element.id = id
        top_element.innerText = name
        return top_element
    }

    function create_bot_element(id)
    {
        let bot_element = document.createElement("div")
        bot_element.className = 'panel'
        bot_element.id = id
        return bot_element
    }

    function create_element_pair(id, name)
    {
        let top_element = create_top_element(id + "_top", name)
        let bot_element = create_bot_element(id + "_bot")
        return [top_element, bot_element]
    }

    function insert_element_pair(target, pair)
    {
        target.innerHTML += pair[0]
        target.innerHTML += '\n'
        target.innerHTML += pair[1]
    }
    
    function data_to_element(root_id, json_string)
    {
      const data = JSON.parse(json_string);
      let root_element = document.getElementById(root_id)
      for (const router in data)
      {
          let router_name = router['name']

          // prepare networks
          let networks_elements = create_element_pair(router_name + "_networks", 'Networks')
          for (const address in router['networks']) networks_elements[1].innerHTML += address + "<br>"

          // prepare offenses
          let offenses_elements = create_element_pair(router_name + "_offenses", "Offenses")
          for (const offense in router["offenses"])
          {
              // TODO add some totally superb processing here
              continue
          }

          // prepare devices
          let devices_elements = create_element_pair(router_name + '_devices', "Devices")
          for (const device in router["devices"])
          {
              let IP_adds = ""
              for (const add in device['ip']) IP_adds += add + " "
              devices_elements[1].innerHTML += "MAC: " + device["mac"] + "<br>IP: " + IP_adds + "<br>"
          }

          // create router
          let router_elements = create_element_pair(router_name, router_name)

          // fill router
          insert_element_pair(router_elements[1], networks_elements)
          insert_element_pair(router_elements[1], offenses_elements)
          insert_element_pair(router_elements[1], devices_elements)

          // wrap it up by inserting into target
          insert_element_pair(root_element, router_elements)
      }
    }

  </script>

<!--
REUSED CODE
W3Schools
From: https://www.w3schools.com/howto/howto_js_accordion.asp
Date: 10. 03. 2023
-->

<style>
  .accordion
  {
    background-color: white;
    color: #444;
    cursor: pointer;
    padding: 2px;
    width: 100%;
    border: none;
    text-align: left;
    outline: none;
    font-size: 15px;
    transition: 0.4s;
  }
  
  .active, .accordion:hover
  {
    background-color: #ccc; 
  }
  
  .panel
  {
    padding: 0 20px;
    display: none;
    background-color: white;
    overflow: hidden;


    border: none;
    text-align: left;
    outline: none;
    font-size: 15px;
  }
  </style>

<script>
  var acc = document.getElementsByClassName("accordion");
  var i;
  
  for (i = 0; i < acc.length; i++)
  {
    acc[i].addEventListener("click", function()
    {
      this.classList.toggle("active");
      var panel = this.nextElementSibling;
      if (panel.style.display === "block")
      {
        panel.style.display = "none";
      }
      else
      {
        panel.style.display = "block";
      }
    });
  }
</script>

<!-- END OF REUSED CODE -->

</html>